<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Logging System Demo</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
        }
        .log-display {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
            max-height: 300px;
            overflow-y: auto;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
        }
        .step {
            margin: 5px 0;
            padding: 5px;
            border-left: 3px solid #007bff;
        }
    </style>
</head>
<body>
    <h1>Logging System Demo</h1>
    
    <div id="server-status" class="status">
        Checking server status...
    </div>

    <div id="log-files" class="log-display">
        <h3>Saved Log Files:</h3>
        <div id="files-list"></div>
    </div>

    <div id="demo-controls">
        <button id="start-demo">Start Demo Routine</button>
        <button id="check-logs">Check Log Files</button>
    </div>

    <div id="current-step" class="step">
        Ready to start
    </div>

    <div id="demo-status" class="status"></div>

    <script>
        const API_BASE = 'http://localhost:3000/api';
        let demoLogs = [];
        let currentStep = 0;
        let isDemoRunning = false;

        // Check server status
        async function checkServerStatus() {
            try {
                const response = await fetch(`${API_BASE}/test`);
                const data = await response.json();
                document.getElementById('server-status').innerHTML = 
                    `<div class="success">Server is running: ${data.message}</div>`;
            } catch (error) {
                document.getElementById('server-status').innerHTML = 
                    `<div class="error">Server is not running: ${error.message}</div>`;
            }
        }

        // List saved log files
        async function listLogFiles() {
            try {
                const response = await fetch(`${API_BASE}/logs`);
                const data = await response.json();
                const filesList = document.getElementById('files-list');
                filesList.innerHTML = data.files.map(file => 
                    `<div>${file.name} (${(file.size / 1024).toFixed(2)} KB)</div>`
                ).join('');
            } catch (error) {
                console.error('Error listing logs:', error);
            }
        }

        // Generate demo logs
        function generateDemoLogs() {
            const steps = [
                'Takeoff', 'Hover', 'Forward', 'Backward', 'Left', 'Right',
                'Rotate Left', 'Rotate Right', 'Land', 'Reset'
            ];

            const logs = [];
            let timestamp = Date.now();

            steps.forEach((step, index) => {
                // Generate 20 log entries per step
                for (let i = 0; i < 20; i++) {
                    logs.push({
                        timestamp: timestamp + (i * 100),
                        position: {
                            x: (Math.random() * 10 - 5).toFixed(2),
                            y: (10 + Math.random() * 5).toFixed(2),
                            z: (Math.random() * 10 - 5).toFixed(2)
                        },
                        rotation: {
                            x: (Math.random() * 0.5 - 0.25).toFixed(2),
                            y: (Math.random() * 0.5 - 0.25).toFixed(2),
                            z: (Math.random() * 0.5 - 0.25).toFixed(2)
                        },
                        controls: {
                            throttle: (Math.random()).toFixed(2),
                            pitch: (Math.random() * 2 - 1).toFixed(2),
                            roll: (Math.random() * 2 - 1).toFixed(2),
                            yaw: (Math.random() * 2 - 1).toFixed(2)
                        },
                        currentStep: step
                    });
                }
                timestamp += 2000; // 2 seconds per step
            });

            return logs;
        }

        // Save logs to server
        async function saveLogs(logs) {
            try {
                const response = await fetch(`${API_BASE}/save-logs`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(logs)
                });
                const data = await response.json();
                if (data.success) {
                    document.getElementById('demo-status').innerHTML = 
                        `<div class="success">Logs saved successfully: ${data.filename}</div>`;
                    listLogFiles(); // Refresh the file list
                } else {
                    throw new Error(data.error);
                }
            } catch (error) {
                document.getElementById('demo-status').innerHTML = 
                    `<div class="error">Failed to save logs: ${error.message}</div>`;
            }
        }

        // Run demo routine
        async function runDemo() {
            if (isDemoRunning) return;
            isDemoRunning = true;

            const steps = [
                'Takeoff', 'Hover', 'Forward', 'Backward', 'Left', 'Right',
                'Rotate Left', 'Rotate Right', 'Land', 'Reset'
            ];

            document.getElementById('demo-status').innerHTML = '';
            document.getElementById('start-demo').disabled = true;

            for (let i = 0; i < steps.length; i++) {
                currentStep = i;
                document.getElementById('current-step').textContent = `Current Step: ${steps[i]}`;
                await new Promise(resolve => setTimeout(resolve, 2000)); // 2 seconds per step
            }

            // Generate and save logs
            demoLogs = generateDemoLogs();
            await saveLogs(demoLogs);

            document.getElementById('start-demo').disabled = false;
            isDemoRunning = false;
        }

        // Event listeners
        document.getElementById('start-demo').addEventListener('click', runDemo);
        document.getElementById('check-logs').addEventListener('click', listLogFiles);

        // Initial setup
        checkServerStatus();
        listLogFiles();
    </script>
</body>
</html> 